


## 图片编辑：

前段时间在公司做了一个图片批改系统用于老师端批改作业，效果类似于微信的图片编辑 或 iPad keynote 笔迹图片编辑，主要功能包括 书写笔迹 + 文字 + 图片。

笔迹：支持粗细，颜色，套索，橡皮擦等
文字：输入，删除，变更
图片：插入，删除，缩放，旋转
这些显示的操作都需要支持 撤销和恢复 （undo/redo）

#### 笔迹

**绘制**：
1. 使用 CAShapeLayer 来做绘制
2. 因为需要手指触摸开始移动开始画线，使用 UIPanGesture 起笔会有延迟，体验不好，所以在 touchesBeagn/move 中收集点
3. 生成到 UIBezierPath，更新 shapeLayer 绘制

**橡皮擦**：
橡皮擦功能
其实也是划线，不过需要在划线过程中，计算线段相交，得到相交的线段并 hide

线段相交算法：https://segmentfault.com/a/1190000004070478

**套索：**
* shapeLayer 绘制虚线，最后 封闭图形，closePath
* 套索判断包含，iOS上可以直接使用 bezierPath containPoint 来判断 （默认是使用非零环绕数）

文字/图片

* 单个点拖动支持旋转缩放
iOS 系统只有双指的旋转和缩放，单点的需要单独实现。
实现原理如图：





    
